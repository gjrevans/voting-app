{% extends "layouts/default.html" %}

{% block content %}
<div class="container-fluid mt-3">
    <div class="row">
        <div class="col-md-4 offset-md-4">
            <h1>{{ poll.name }}</h1>
            <canvas id="myChart"></canvas>

        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script type="text/javascript">
// Define our polls results object in a nasty nunjucks hack
var data = {{ poll | dump | safe }}.results;
console.log(data);

// Some ugly ass JS to create random colors
var backgroundColors = [];
Object.keys(data).forEach(function(){
    backgroundColors.push(createHex());
});

function createHex() {
    return '#' + Math.floor(Math.random() * 16777215).toString(16);
}

// Create our data
var labels = [];
data.forEach(function(e){
    labels.push(e.option);
});

var votes = [];
data.forEach(function(e){
    votes.push(e.votes);
});

// This creates the chart and pushes it to the myChart canvas
var ctx = document.getElementById('myChart').getContext('2d');
var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: labels,
        datasets: [{
            label: 'votes',
            data: votes,
            backgroundColor: backgroundColors
        }]
    }
});
</script>
<!-- Use this to insert JS into a page -->
<!-- Important to put JS here so that JQUERY is available to the page -->
{% endblock %}
